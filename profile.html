<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>个人主页 · Movie Mingle</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="header">
    <div class="container clearfix">
      <div class="logo left"><h1><img src="imgs/favicon.jpg" alt="Movie Mingle" class="logo-img"></h1></div>
      <div class="search left">
        <form>
          <input type="text" placeholder="搜索电影、影人、话题...">
          <button type="submit" class="search-btn" aria-label="search"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.35-4.35" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="10.5" cy="10.5" r="6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        </form>
      </div>
      <div class="menu right">
        <a href="index.html" class="menu-item">主页</a>
        <a href="movies.html" class="menu-item">电影</a>
        <a href="topics.html" class="menu-item">话题</a>
        <a href="community.html" class="menu-item">社区</a>
      </div>
      <div id="header-user" class="header-user"></div>
    </div>
  </header>

  <div class="container main profile-page">
    <div class="profile-left" style="float:left; width:65%;">
      <h2>个人主页 · <span id="profile-name"></span></h2>
      <div class="profile-card" style="display:flex; gap:12px; align-items:center; margin:12px 0 18px;">
        <img id="profile-avatar" src="imgs/kurosawa.jpg" alt="avatar" style="width:96px; height:96px; object-fit:cover; border-radius:6px;">
        <div style="flex:1">
          <div style="display:flex; gap:12px; align-items:center;">
            <div><strong id="profile-display-name"></strong></div>
            <div style="color:#666; font-size:13px;">· 帖子 <span id="profile-posts-count">0</span></div>
            <div style="color:#666; font-size:13px;">· 粉丝 <span id="profile-followers-count">0</span></div>
            <div style="color:#666; font-size:13px;">· 关注 <span id="profile-following-count">0</span></div>
          </div>
          <div id="profile-bio-display" style="color:#666; margin-top:6px;">（未填写个人简介）</div>
          <div style="margin-top:8px; display:flex; gap:8px; align-items:center;" id="profile-actions">
            <div><button id="edit-profile-btn" class="btn">编辑资料</button></div>
          </div>
        </div>
      </div>
      <div id="profile-message-box" style="display:none; margin-bottom:12px;">
        <form id="profile-message-form" class="box" style="padding:10px; background:#fff;">
          <div><label>发送私信给 <strong id="profile-message-to"></strong></label></div>
          <div style="margin-top:6px;"><textarea id="profile-message-text" style="width:100%; height:80px; padding:8px;"></textarea></div>
          <div style="margin-top:8px;"><button class="btn" type="submit">发送</button></div>
        </form>
      </div>
      <div id="profile-edit-box" style="display:none; margin-bottom:18px;">
        <form id="profile-edit-form" class="box" style="background:#fff; padding:12px;">
          <div>
            <label>显示名称</label><br>
            <input id="profile-display" type="text" placeholder="显示名称，默认为用户名" style="width:100%; padding:8px; margin-top:6px;" />
          </div>
          <div style="margin-top:8px;">
            <label>个人简介</label><br>
            <textarea id="profile-bio" style="width:100%; height:80px; padding:8px; margin-top:6px;"></textarea>
          </div>
          <div style="margin-top:8px;">
            <label>头像上传（可选，支持 JPG/PNG）</label><br>
            <input id="profile-avatar-file" type="file" accept="image/*" style="margin-top:6px;" />
          </div>
          <div style="margin-top:10px;"><button class="btn" type="submit">保存资料</button></div>
        </form>
      </div>
      <div class="composer">
        <form id="compose-form">
          <textarea id="compose-text" placeholder="此刻你想要分享..." style="width:100%; height:60px; padding:8px;"></textarea>
          <div style="margin-top:8px;"><button class="btn" type="submit">发布</button></div>
        </form>
      </div>

      <div id="feed" style="margin-top:18px;"></div>
    </div>

    <aside class="profile-right" style="float:right; width:30%;">
      <div class="box">
        <h4>正在发生</h4>
        <ul>
          <li>热门话题</li>
          <li>推荐清单</li>
        </ul>
      </div>
      <div class="box" style="margin-top:12px;">
        <h4>你可能喜欢</h4>
        <img src="imgs/oppenheimer.jpg" alt="推荐" style="width:100%; border-radius:4px;"/>
      </div>
    </aside>

    <div style="clear:both"></div>
  </div>

  <footer class="footer">
    <div class="container">&copy; 2025 Movie Mingle</div>
  </footer>

  <script src="scripts/site-auth.js"></script>
  <script>
    // prepare sample posts and render
    siteAuth.ensureSamplePosts();
    // decide whether we're viewing someone else's profile via ?user=USERNAME
    siteAuth.renderHeader();
    const params = new URLSearchParams(window.location.search);
    const targetUser = params.get('user');
    const cur = siteAuth.getCurrentUser();
    // If targetUser is present but equals current logged-in user, treat as own profile (allow editing).
    if(targetUser){
      if(cur && cur.username === targetUser){
        // own profile (URL contains ?user=current) - treat as own
        siteAuth.renderProfile();
        siteAuth.wireProfileEditor();
      } else {
        // viewing someone else's profile
        siteAuth.renderProfile(targetUser);
        // show the recipient in the message box
        const toSpan = document.getElementById('profile-message-to'); if(toSpan) toSpan.textContent = targetUser;
        // do not wire editor when viewing others
      }
    } else {
      // no user param - own profile
      siteAuth.renderProfile();
      siteAuth.wireProfileEditor();
    }
  </script>
</body>
</html>
